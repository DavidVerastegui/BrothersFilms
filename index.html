<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Contrato de Fotograf√≠a y Video ‚Äì BrothersFilms Saltillo</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --gold: #c9a84c;
      --gold-light: #e8d5a3;
      --dark: #1a1a1a;
      --gray: #4a4a4a;
      --gray-light: #7a7a7a;
      --bg: #faf8f5;
      --white: #fff;
      --border: #d8cfbf;
      --green: #2e7d52;
      --red: #c0392b
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--dark);
      font-size: 14px;
      line-height: 1.6
    }

    /* ‚îÄ‚îÄ BANNER DE MODO ‚îÄ‚îÄ */
    #mode-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 24px;
      font-size: 13px;
      font-weight: 600;
      gap: 12px
    }

    #mode-banner.admin {
      background: var(--dark);
      color: var(--gold-light)
    }

    #mode-banner.client {
      background: #1b4332;
      color: #d1fae5
    }

    .mode-label {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .mode-actions {
      display: flex;
      gap: 8px
    }

    .mbtn {
      padding: 7px 16px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      font-family: 'Inter', sans-serif
    }

    .mbtn-gold {
      background: var(--gold);
      color: #fff
    }

    .mbtn-gold:hover {
      background: #b8943e
    }

    .mbtn-outline {
      background: transparent;
      color: var(--gold-light);
      border: 1.5px solid var(--gold)
    }

    .mbtn-outline:hover {
      background: rgba(201, 168, 76, .15)
    }

    .mbtn-green {
      background: var(--green);
      color: #fff
    }

    .mbtn-green:hover {
      background: #256644
    }

    .mbtn-dark {
      background: #333;
      color: #fff
    }

    .mbtn-dark:hover {
      background: #444
    }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    .page {
      max-width: 860px;
      margin: 70px auto 40px;
      background: var(--white);
      box-shadow: 0 8px 40px rgba(0, 0, 0, .12);
      border-radius: 4px;
      overflow: hidden
    }

    .header {
      background: var(--dark);
      padding: 32px 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px
    }

    .brand-logo {
      height: 38px;
      max-width: 100%;
      object-fit: contain;
      display: block;
      /* The logo has black text, invert it to white so it displays nicely on the dark header */
      filter: invert(1) brightness(1.2);
    }

    .brand-sub {
      font-size: 11px;
      color: var(--gold-light);
      letter-spacing: 3px;
      text-transform: uppercase;
      margin-top: 2px
    }

    .header-title h1 {
      font-family: 'Playfair Display', serif;
      font-size: 17px;
      color: #fff;
      font-weight: 600;
      text-align: right
    }

    .header-title p {
      font-size: 10px;
      color: var(--gold-light);
      letter-spacing: 1px;
      text-transform: uppercase;
      text-align: right;
      margin-top: 3px
    }

    .gold-band {
      height: 4px;
      background: linear-gradient(90deg, var(--gold) 0%, #e8d5a3 50%, var(--gold) 100%)
    }

    .body {
      padding: 36px 48px
    }

    .section {
      margin-bottom: 30px
    }

    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 14px;
      font-weight: 700;
      color: var(--dark);
      border-bottom: 2px solid var(--gold);
      padding-bottom: 5px;
      margin-bottom: 14px;
      text-transform: uppercase;
      letter-spacing: .5px
    }

    .divider {
      border: none;
      border-top: 1px solid var(--border);
      margin: 24px 0
    }

    /* ‚îÄ‚îÄ INFO GRID ‚îÄ‚îÄ */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px 24px
    }

    .info-field {
      display: flex;
      flex-direction: column;
      gap: 3px
    }

    .info-field.full {
      grid-column: 1/-1
    }

    .info-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .info-value {
      border: none;
      border-bottom: 1px solid var(--border);
      min-height: 28px;
      font-size: 13px;
      padding: 2px 4px;
      color: var(--dark);
      border-radius: 3px 3px 0 0;
      width: 100%;
      font-family: 'Inter', sans-serif;
      background: transparent;
    }

    .info-value:focus,
    .info-value[contenteditable="true"]:focus {
      outline: none;
      border-bottom-color: var(--gold);
      background: #fffdf7
    }

    .info-value:disabled,
    .info-value.disabled,
    .info-value[contenteditable="false"] {
      background: #f7f5f0;
      color: var(--gray)
    }

    .contract-num {
      font-size: 11px;
      color: var(--gray-light);
      text-align: right;
      margin-top: 6px
    }

    /* ‚îÄ‚îÄ PLANS ‚îÄ‚îÄ */
    .plans-container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px
    }

    .plan-card {
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      cursor: pointer;
      transition: all .25s;
      position: relative;
      background: #fff
    }

    .plan-card:hover {
      border-color: var(--gold);
      box-shadow: 0 4px 16px rgba(201, 168, 76, .2)
    }

    .plan-card.selected {
      border-color: var(--gold);
      background: #fffdf0;
      box-shadow: 0 4px 16px rgba(201, 168, 76, .3)
    }

    .plan-card.selected::after {
      content: '‚úì';
      position: absolute;
      top: 10px;
      right: 12px;
      color: var(--gold);
      font-size: 16px;
      font-weight: 700
    }

    .plan-card.locked {
      cursor: default;
      pointer-events: none
    }

    .plan-tag {
      font-size: 10px;
      color: var(--gold);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
      display: block
    }

    .plan-name {
      font-family: 'Playfair Display', serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--dark)
    }

    .plan-price {
      font-size: 19px;
      font-weight: 700;
      color: var(--gold);
      margin: 6px 0;
      font-family: 'Playfair Display', serif
    }

    .plan-price span {
      font-size: 11px;
      font-weight: 400;
      color: var(--gray-light);
      font-family: 'Inter', sans-serif
    }

    .plan-hours {
      font-size: 11px;
      color: var(--gray);
      margin-bottom: 8px;
      font-weight: 500
    }

    .plan-services {
      list-style: none;
      padding: 0
    }

    .plan-services li {
      font-size: 11px;
      color: var(--gray);
      padding: 2px 0 2px 12px;
      position: relative;
      line-height: 1.4
    }

    .plan-services li::before {
      content: '‚Ä∫';
      position: absolute;
      left: 0;
      color: var(--gold);
      font-weight: 700
    }

    /* ‚îÄ‚îÄ SERVICES ‚îÄ‚îÄ */
    .services-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0
    }

    .service-category {
      padding: 14px;
      border: 1px solid var(--border);
      margin: -1px 0 0 -1px
    }

    .service-category-title {
      font-size: 11px;
      font-weight: 700;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px
    }

    .service-item {
      display: flex;
      align-items: flex-start;
      gap: 7px;
      margin-bottom: 5px
    }

    .chk {
      width: 14px;
      height: 14px;
      border: 1.5px solid var(--border);
      border-radius: 2px;
      flex-shrink: 0;
      margin-top: 1px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--gold)
    }

    .chk.on {
      background: var(--gold);
      border-color: var(--gold);
      color: #fff
    }

    .service-text {
      font-size: 11px;
      color: var(--gray);
      line-height: 1.4
    }

    /* ‚îÄ‚îÄ CL√ÅUSULAS ‚îÄ‚îÄ */
    .clauses-list {
      counter-reset: clause;
      list-style: none
    }

    .clause-item {
      counter-increment: clause;
      margin-bottom: 12px;
      padding-left: 26px;
      position: relative
    }

    .clause-item::before {
      content: counter(clause)".";
      position: absolute;
      left: 0;
      top: 0;
      font-weight: 700;
      color: var(--gold);
      font-size: 13px
    }

    .clause-title {
      font-weight: 600;
      font-size: 12px;
      color: var(--dark);
      margin-bottom: 3px
    }

    .clause-text {
      font-size: 11px;
      color: var(--gray);
      line-height: 1.7
    }

    .clause-hi {
      background: #fffbf0;
      border-left: 3px solid var(--gold);
      padding: 7px 11px;
      margin-top: 5px;
      border-radius: 0 4px 4px 0;
      font-size: 11px;
      color: var(--gray)
    }

    /* ‚îÄ‚îÄ PAGOS ‚îÄ‚îÄ */
    .pay-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px
    }

    .pay-table th {
      background: var(--dark);
      color: var(--gold-light);
      padding: 8px 11px;
      text-align: left;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .4px
    }

    .pay-table td {
      border-bottom: 1px solid var(--border);
      padding: 7px 11px;
      color: var(--gray)
    }

    .pay-table tr:nth-child(even) td {
      background: #faf8f5
    }

    .pay-table td:first-child {
      font-weight: 600;
      color: var(--dark)
    }

    .pay-table .total-row td {
      background: #fffdf0;
      font-weight: 700;
      color: var(--dark);
      border-bottom: 2px solid var(--gold)
    }

    /* ‚îÄ‚îÄ NOTAS ‚îÄ‚îÄ */
    .notes-box {
      background: #f8f5ef;
      border: 1px solid var(--border);
      border-left: 4px solid var(--gold);
      border-radius: 4px;
      padding: 14px
    }

    .note-item {
      display: flex;
      gap: 7px;
      margin-bottom: 5px;
      font-size: 11px;
      color: var(--gray)
    }

    .note-item::before {
      content: '‚ö†';
      color: var(--gold);
      flex-shrink: 0
    }

    /* ‚îÄ‚îÄ FIRMA DIGITAL ‚îÄ‚îÄ */
    .sig-section {
      margin-top: 32px
    }

    .sig-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px
    }

    .sig-box {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .sig-label {
      font-size: 10px;
      font-weight: 700;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .sig-canvas-wrap {
      position: relative;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      background: #fdfcf8
    }

    .sig-canvas-wrap canvas {
      display: block;
      width: 100%;
      touch-action: none
    }

    .sig-canvas-wrap .sig-placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 11px;
      color: #ccc;
      pointer-events: none;
      text-align: center;
      line-height: 1.5
    }

    .sig-actions {
      display: flex;
      gap: 6px;
      margin-top: 4px
    }

    .sig-btn {
      padding: 5px 12px;
      border: 1.5px solid var(--border);
      border-radius: 5px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      background: #fff;
      color: var(--gray);
      transition: all .2s;
      font-family: 'Inter', sans-serif
    }

    .sig-btn:hover {
      border-color: var(--gold);
      color: var(--gold)
    }

    .sig-name {
      margin-top: 6px;
      border-bottom: 1px solid var(--border);
      padding: 3px 4px;
      font-size: 12px;
      min-height: 26px
    }

    .sig-name[contenteditable="true"]:focus {
      outline: none;
      border-bottom-color: var(--gold);
      background: #fffdf7
    }

    .sig-sublabel {
      font-size: 10px;
      color: var(--gray-light);
      margin-top: 2px
    }

    .sig-date {
      font-size: 11px;
      color: var(--gray-light);
      margin-top: 4px
    }

    /* ‚îÄ‚îÄ FIRMA EST√ÅTICA (modo impresi√≥n) ‚îÄ‚îÄ */
    .sig-static {
      height: 70px;
      border-bottom: 1.5px solid var(--dark);
      margin-bottom: 6px
    }

    /* ‚îÄ‚îÄ ESTADO FIRMADO ‚îÄ‚îÄ */
    .signed-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #d1fae5;
      color: #064e3b;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      margin-top: 6px
    }

    /* ‚îÄ‚îÄ MODAL DE CONFIRMACI√ìN ‚îÄ‚îÄ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      z-index: 2000;
      align-items: center;
      justify-content: center
    }

    .modal-overlay.show {
      display: flex
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      padding: 32px;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3)
    }

    .modal h2 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      color: var(--dark);
      margin-bottom: 8px
    }

    .modal p {
      font-size: 13px;
      color: var(--gray);
      margin-bottom: 20px;
      line-height: 1.6
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap
    }

    .modal-icon {
      font-size: 48px;
      margin-bottom: 12px
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    .footer {
      background: var(--dark);
      color: var(--gold-light);
      text-align: center;
      padding: 14px 48px;
      font-size: 11px;
      letter-spacing: 1px
    }

    .footer strong {
      color: var(--gold)
    }

    /* ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ */
    @page {
      /* Definir m√°rgenes propios elimina los encabezados autom√°ticos del navegador
         (URL, fecha/hora) en Chrome, Edge y Safari */
      margin: 1cm 1.2cm;
      size: letter portrait;
    }

    @media print {

      #mode-banner,
      .sig-actions,
      .sig-btn,
      .modal-overlay {
        display: none !important
      }

      body {
        background: #fff
      }

      .page {
        box-shadow: none;
        margin: 0;
        max-width: 100%;
        border-radius: 0
      }

      .sig-canvas-wrap {
        border: 1px solid #ccc
      }
    }

    @media(max-width:700px) {
      .page {
        margin-top: 140px;
        /* Account for taller wrapped banner on mobile */
      }

      #mode-banner {
        flex-direction: column;
        padding: 10px 16px;
      }

      .mode-actions {
        flex-wrap: wrap;
        justify-content: center;
      }

      .body {
        padding: 20px 16px
      }

      .header {
        padding: 20px 16px;
        flex-direction: column
      }

      .plans-container,
      .services-grid,
      .info-grid,
      .sig-grid {
        grid-template-columns: 1fr
      }

      .pay-table-wrapper {
        width: 100%;
        overflow-x: auto;
        display: block;
        padding-bottom: 5px;
      }

      .pay-table {
        min-width: 550px;
      }
    }
  </style>
</head>

<body>

  <!-- BANNER DE MODO -->
  <div id="mode-banner" class="admin">
    <div class="mode-label">
      <span id="mode-icon">üîß</span>
      <span id="mode-text">MODO ADMINISTRADOR ‚Äî Prepara el contrato y luego comp√°rtelo con el cliente</span>
    </div>
    <div class="mode-actions">
      <button class="mbtn mbtn-outline" onclick="fillSample()">üìù Ejemplo</button>
      <button class="mbtn mbtn-gold" onclick="generarLinkCliente()">üîó Generar Link para Cliente</button>
      <button class="mbtn mbtn-dark" onclick="window.print()">üñ®Ô∏è Imprimir</button>
    </div>
  </div>

  <div class="page" id="contract-page">

    <!-- HEADER -->
    <div class="header">
      <div>
        <img src="logo.png" alt="BrothersFilms Logo" class="brand-logo" />
        <div class="brand-sub">Saltillo, Coahuila</div>
      </div>
      <div class="header-title">
        <h1>Contrato de Servicios</h1>
        <p>Fotograf√≠a &amp; Video para Boda</p>
      </div>
    </div>
    <div class="gold-band"></div>

    <div class="body">

      <!-- ‚ë† DATOS -->
      <div class="section">
        <div class="section-title">‚ë† Datos del Contrato</div>
        <div class="info-grid">
          <div class="info-field">
            <span class="info-label">Nombre del Contratante</span>
            <input type="text" class="info-value" id="f-contratante" placeholder="Ej. Mar√≠a Gonz√°lez">
          </div>
          <div class="info-field">
            <span class="info-label">Fecha de Firma</span>
            <input type="date" class="info-value" id="f-fecha-firma">
          </div>
          <div class="info-field full">
            <span class="info-label">Nombre de los Novios</span>
            <input type="text" class="info-value" id="f-novios" placeholder="Ej. Ana & Carlos">
          </div>
          <div class="info-field">
            <span class="info-label">Fecha del Evento</span>
            <input type="date" class="info-value" id="f-fecha-evento">
          </div>
          <div class="info-field">
            <span class="info-label">Lugar / Ciudad de la Recepci√≥n</span>
            <input type="text" class="info-value" id="f-lugar" placeholder="Ej. Hacienda San Agust√≠n, Saltillo">
          </div>
          <div class="info-field">
            <span class="info-label">Tel√©fono de Contacto</span>
            <input type="tel" class="info-value" id="f-tel" placeholder="Ej. 844 123 4567">
          </div>
          <div class="info-field">
            <span class="info-label">Correo Electr√≥nico</span>
            <input type="email" class="info-value" id="f-email" placeholder="Para enviar confirmaci√≥n">
          </div>
        </div>
        <div class="contract-num">No. de Contrato: <span id="contract-num">BFS-2026-___</span></div>
      </div>

      <!-- ‚ë° PLAN -->
      <div class="section">
        <div class="section-title">‚ë° Plan Elegido</div>
        <p style="font-size:12px;color:var(--gray);margin-bottom:12px">Selecciona el paquete contratado.</p>
        <div class="plans-container">

          <div class="plan-card" id="plan-basico" onclick="selectPlan('basico')">
            <span class="plan-tag">Pack B√°sico</span>
            <div class="plan-name">Lo Imprescindible</div>
            <div class="plan-price">$19,500 <span>MXN</span></div>
            <div class="plan-hours">‚è± 8 horas de cobertura</div>
            <ul class="plan-services">
              <li>Sesi√≥n formal el d√≠a del evento</li>
              <li>Cobertura de ceremonia y recepci√≥n</li>
              <li>Fotograf√≠a ilimitada</li>
              <li>Video Full HD (15-20 min) + Highlight</li>
              <li>Entrega digital compartible</li>
            </ul>
          </div>

          <div class="plan-card" id="plan-estandar" onclick="selectPlan('estandar')">
            <span class="plan-tag">Pack Est√°ndar ‚≠ê Recomendado</span>
            <div class="plan-name">Lo Recomendado</div>
            <div class="plan-price">$25,500 <span>MXN</span></div>
            <div class="plan-hours">‚è± 10 horas de cobertura</div>
            <ul class="plan-services">
              <li>Sesi√≥n previa "Save the Date"</li>
              <li>Cobertura maquillaje + First Look</li>
              <li>Sesi√≥n formal y cobertura completa</li>
              <li>Fotograf√≠a ilimitada</li>
              <li>Video Full HD (~40 min) + Highlight</li>
              <li>Entrega digital compartible</li>
            </ul>
          </div>

          <div class="plan-card" id="plan-premium" onclick="selectPlan('premium')">
            <span class="plan-tag">Pack Premium üíé Lo Especial</span>
            <div class="plan-name">La Experiencia Completa</div>
            <div class="plan-price">$32,500 <span>MXN</span></div>
            <div class="plan-hours">‚è± 12 horas de cobertura</div>
            <ul class="plan-services">
              <li>Save the Date + Video Slideshow redes</li>
              <li>Cobertura total: maquillaje ‚Üí recepci√≥n</li>
              <li>Sesi√≥n familiar y con damas</li>
              <li>Tomas con Dron (a√©reas)</li>
              <li>Video Full HD (~60 min) + Highlight</li>
              <li>Impresi√≥n 20x24 enmarcada + 50 fotos 6x9</li>
              <li>Caja de madera personalizada</li>
              <li>USB + plataforma digital</li>
            </ul>
          </div>

        </div>
        <div style="margin-top:12px;display:flex;align-items:center;gap:10px">
          <span style="font-size:12px;color:var(--gray);font-weight:500">Plan seleccionado:</span>
          <span id="plan-badge"
            style="background:var(--gold);color:#fff;padding:3px 13px;border-radius:20px;font-size:12px;font-weight:600">Ninguno
            ‚Äî selecciona arriba</span>
        </div>
      </div>

      <!-- ‚ë¢ SERVICIOS -->
      <div class="section">
        <div class="section-title">‚ë¢ Servicios Incluidos</div>
        <div class="services-grid">
          <div class="service-category">
            <div class="service-category-title">üé¨ Previo a la Boda</div>
            <div class="service-item" id="s-std" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Sesi√≥n "Save the Date" (sesi√≥n de pareja
                previa)</span>
            </div>
            <div class="service-item" id="s-vidsesion" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Video sesi√≥n previa 2-3 min para redes (incluye
                dron)</span>
            </div>
            <div class="service-item" id="s-slide" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Slideshow vertical para redes sociales</span>
            </div>
            <div class="service-item" id="s-noprevio">
              <div class="chk">‚Äì</div><span class="service-text" style="color:#bbb">Sin servicios previos en este
                plan</span>
            </div>
          </div>
          <div class="service-category">
            <div class="service-category-title">üíç D√≠a de la Boda</div>
            <div class="service-item" id="s-makeup" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Cobertura durante maquillaje de la novia</span>
            </div>
            <div class="service-item" id="s-fl" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">First Look (primer encuentro antes de
                ceremonia)</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Sesi√≥n formal el d√≠a del evento</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Cobertura de ceremonia, civil y recepci√≥n
                completa</span>
            </div>
            <div class="service-item" id="s-familia" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Sesi√≥n familiar y con damas de honor</span>
            </div>
            <div class="service-item" id="s-dron" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Tomas con Dron (salida misa, vals, entrada
                recepci√≥n)</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Fotograf√≠a ilimitada durante el evento</span>
            </div>
          </div>
          <div class="service-category">
            <div class="service-category-title">üì¶ Entregables Digitales</div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Fotograf√≠as editadas (luz, color y contraste)</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text" id="s-vidduration">Video Full HD editado y
                musicalizado (15-20 min)</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Video Highlight (resumen 2-3 min momentos
                especiales)</span>
            </div>
            <div class="service-item">
              <div class="chk on">‚úì</div><span class="service-text">Entrega en plataforma digital compartible</span>
            </div>
            <div class="service-item" id="s-usb" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Entrega adicional en Memoria USB</span>
            </div>
          </div>
          <div class="service-category">
            <div class="service-category-title">üñºÔ∏è Entregables F√≠sicos</div>
            <div class="service-item" id="s-imp2024" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Impresi√≥n 20x24 enmarcada</span>
            </div>
            <div class="service-item" id="s-50fotos" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">50 fotograf√≠as impresas tama√±o 6x9</span>
            </div>
            <div class="service-item" id="s-caja" style="display:none">
              <div class="chk on">‚úì</div><span class="service-text">Caja de madera personalizada con nombre de los
                novios</span>
            </div>
            <div class="service-item" id="s-nofisico">
              <div class="chk" style="color:#bbb;border-color:#ddd">‚Äì</div><span class="service-text"
                style="color:#bbb">Sin impresiones f√≠sicas en este plan</span>
            </div>
          </div>
        </div>
      </div>

      <hr class="divider" />

      <!-- ‚ë£ CL√ÅUSULAS -->
      <div class="section">
        <div class="section-title">‚ë£ T√©rminos y Condiciones</div>
        <ol class="clauses-list">
          <li class="clause-item">
            <div class="clause-title">Alimentaci√≥n y log√≠stica en el evento</div>
            <div class="clause-text">El cliente podr√° incluir al equipo de BrothersFilms en la alimentaci√≥n durante el
              evento, especialmente en jornadas mayores a 4 horas. Se requiere contar con mesa y sillas para el equipo,
              separada de invitados y staff. En caso de no incluir alimentaci√≥n, se notificar√° al equipo con m√≠nimo 48
              horas de anticipaci√≥n.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Abonos, pagos y reservaci√≥n de fecha</div>
            <div class="clause-text">La fecha se reserva √∫nicamente con el anticipo confirmado. Esquema de pagos:</div>
            <div class="clause-hi">‚Ä¢ <strong>Anticipo inicial:</strong> Al firmar el contrato (reserva la fecha).<br>‚Ä¢
              <strong>30% del total:</strong> En los primeros 3 meses desde la firma.<br>‚Ä¢ <strong>50% del
                total:</strong> Antes de realizar la sesi√≥n "Save the Date".<br>‚Ä¢ <strong>100% del total:</strong>
              M√≠nimo 1 mes antes del evento.
            </div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Entrega de fotograf√≠as y video</div>
            <div class="clause-text">Las fotograf√≠as editadas y el video final (Full HD + Highlight) se entregar√°n en
              formato digital v√≠a enlace de descarga, en un plazo m√°ximo de <strong>3 meses</strong> despu√©s del evento.
              En caso de alg√∫n retraso o inconveniente ajeno al equipo, se notificar√° al cliente con anticipaci√≥n para
              acordar una nueva fecha de entrega.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Entrega de material f√≠sico impreso</div>
            <div class="clause-text">Las fotograf√≠as impresas, impresiones enmarcadas y la caja de madera personalizada
              se entregar√°n en un plazo m√°ximo de <strong>3 meses</strong> despu√©s del evento. Ante cualquier retraso en
              el proceso de impresi√≥n o imprevisto, se informar√° al cliente oportunamente con la nueva fecha estimada de
              entrega.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Selecci√≥n de fotograf√≠as para impresi√≥n</div>
            <div class="clause-text">Los contratantes tendr√°n <strong>3 meses</strong> para seleccionar las fotos de
              impresi√≥n. Sin respuesta en ese plazo, el derecho a impresiones puede perderse o ajustarse en precio.
            </div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Comodidad operativa durante el evento</div>
            <div class="clause-text">Se sugiere informar a los asistentes que eviten levantarse durante la ceremonia
              para no interferir con el equipo de trabajo ni aparecer involuntariamente en fotograf√≠as o videos.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Condiciones para la prestaci√≥n del servicio</div>
            <div class="clause-text">No se realizar√°n tomas en condiciones climatol√≥gicas riesgosas, situaciones que
              pongan en peligro la integridad del equipo, o cuando las condiciones impidan trabajar con seguridad. En
              caso de robo o falla t√©cnica imprevisible, BrothersFilms no se hace responsable por p√©rdida de material
              por causas de fuerza mayor.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Cancelaciones y pol√≠tica de reembolso</div>
            <div class="clause-text">Cancelaci√≥n por parte del cliente:</div>
            <div class="clause-hi">‚Ä¢ El anticipo y pagos realizados <strong>no son reembolsables</strong>.<br>‚Ä¢
              Cancelaci√≥n con 3 meses o menos de anticipaci√≥n: se liquida el <strong>100% del paquete</strong>.<br>‚Ä¢ Si
              BrothersFilms no puede asistir por causas propias: se devuelve <strong>√≠ntegramente todo el
                dinero</strong> pagado.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Cambios de fecha</div>
            <div class="clause-text">Subject a disponibilidad. Puede implicar un cargo adicional del
              <strong>15%</strong> sobre el valor total del contrato.
            </div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Traslados fuera de Saltillo</div>
            <div class="clause-text">Los gastos de transporte, alojamiento y vi√°ticos del equipo fuera de la ciudad
              ser√°n cubiertos por el contratante, salvo que est√©n contemplados en el plan.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Cronograma e informaci√≥n del evento</div>
            <div class="clause-text">El contratante deber√° proporcionar el cronograma del evento antes de la firma.
              Cambios posteriores deber√°n notificarse con anticipaci√≥n y pueden generar nueva cotizaci√≥n.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Edici√≥n y retoque</div>
            <div class="clause-text">La edici√≥n est√°ndar incluye correcci√≥n de luz, color y contraste. Retoques
              est√©ticos adicionales deber√°n negociarse y cotizarse por separado.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Uso de im√°genes con fines promocionales</div>
            <div class="clause-text">Al firmar, el cliente autoriza a BrothersFilms a utilizar fotograf√≠as y videos del
              evento para redes sociales, sitio web y portafolio. No se compartir√° informaci√≥n personal sin
              consentimiento.</div>
          </li>
          <li class="clause-item">
            <div class="clause-title">Aceptaci√≥n total</div>
            <div class="clause-text">La firma de este contrato indica que el cliente ha le√≠do, comprendido y aceptado
              todas las cl√°usulas aqu√≠ establecidas.</div>
          </li>
        </ol>
      </div>

      <hr class="divider" />

      <!-- ‚ë§ PAGOS -->
      <div class="section">
        <div class="section-title">‚ë§ Plan de Pagos</div>
        <div class="pay-table-wrapper">
          <table class="pay-table" id="pay-table">
            <thead>
              <tr>
                <th>Concepto</th>
                <th>Monto (MXN)</th>
                <th>Fecha de Pago</th>
                <th>Forma de Pago</th>
                <th>‚úì</th>
              </tr>
            </thead>
            <tbody>
              <tr class="total-row">
                <td>Total del Contrato</td>
                <td id="total-amt" contenteditable="true">$__________</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
              <tr>
                <td>Anticipo (reserva)</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td>Abono 1</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td>Abono 2</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td>Abono 3</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td>Abono 4</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td>Abono 5</td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
              <tr>
                <td><strong>Saldo Final (1 mes antes)</strong></td>
                <td contenteditable="true">$__________</td>
                <td contenteditable="true">__/__/____</td>
                <td contenteditable="true">___________</td>
                <td contenteditable="true">‚ñ°</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ‚ë• NOTAS -->
      <div class="section">
        <div class="section-title">‚ë• Notas Importantes</div>
        <div class="notes-box">
          <div class="note-item">El 100% del contrato debe estar pagado al menos 1 mes antes del evento.</div>
          <div class="note-item">Guarda comprobante de cada pago realizado a BrothersFilms Saltillo.</div>
          <div class="note-item">Notifica cambios de fecha o lugar con anticipaci√≥n. Pueden generar costo adicional.
          </div>
          <div class="note-item">Las sesiones "Save the Date" requieren el 50% del total pagado previamente.</div>
        </div>
      </div>

      <hr class="divider" />

      <!-- ‚ë¶ FIRMAS -->
      <div class="section sig-section">
        <div class="section-title">‚ë¶ Firmas y Aceptaci√≥n</div>
        <p style="font-size:12px;color:var(--gray);margin-bottom:20px">Al firmar, ambas partes declaran haber le√≠do y
          aceptado todas las cl√°usulas.</p>

        <!-- FIRMA DIGITAL (modo cliente) -->
        <div id="sig-digital" class="sig-grid" style="display:none">
          <div class="sig-box">
            <span class="sig-label">‚úçÔ∏è Firma del Cliente</span>
            <div class="sig-canvas-wrap">
              <canvas id="canvas-client" height="120"></canvas>
              <div class="sig-placeholder" id="ph-client">Firma aqu√≠ con el dedo<br>o con el mouse</div>
            </div>
            <div class="sig-actions">
              <button class="sig-btn" onclick="clearCanvas('client')">üóëÔ∏è Borrar</button>
              <span id="signed-badge-client" style="display:none" class="signed-badge">‚úÖ Firmado</span>
            </div>
            <div class="info-label" style="margin-top:8px">Nombre completo</div>
            <div class="sig-name" id="sig-name-client" contenteditable="true"></div>
            <div class="sig-date" id="sig-date-client"></div>
          </div>
          <div class="sig-box">
            <span class="sig-label">üè¢ BrothersFilms Saltillo</span>
            <div class="sig-canvas-wrap">
              <canvas id="canvas-brothers" height="120"></canvas>
              <div class="sig-placeholder" id="ph-brothers">Firma de BrothersFilms</div>
            </div>
            <div class="sig-actions">
              <button class="sig-btn" onclick="clearCanvas('brothers')">üóëÔ∏è Borrar</button>
              <span id="signed-badge-brothers" style="display:none" class="signed-badge">‚úÖ Firmado</span>
            </div>
            <div class="sig-date" style="margin-top:8px;font-size:11px;color:var(--gray-light)">Representante autorizado
            </div>
          </div>
        </div>

        <!-- FIRMA EST√ÅTICA (modo admin / impresi√≥n) -->
        <div id="sig-static" class="sig-grid">
          <div class="sig-box">
            <div class="sig-static"></div>
            <div style="font-size:11px;font-weight:700;color:var(--dark);text-transform:uppercase;letter-spacing:1px">
              Firma del Cliente</div>
            <div style="font-size:10px;color:var(--gray-light)">Nombre: ___________________________</div>
          </div>
          <div class="sig-box">
            <div class="sig-static"></div>
            <div style="font-size:11px;font-weight:700;color:var(--dark);text-transform:uppercase;letter-spacing:1px">
              Firma BrothersFilms Saltillo</div>
            <div style="font-size:10px;color:var(--gray-light)">Representante autorizado</div>
          </div>
        </div>

        <div style="margin-top:20px;text-align:center;font-size:11px;color:var(--gray-light)">
          Contrato generado el <strong id="contract-date"></strong> ‚Äî Saltillo, Coahuila, M√©xico.
        </div>
      </div>

    </div><!-- /body -->

    <div class="footer">
      <strong>BrothersFilms Saltillo</strong> &nbsp;|&nbsp;
      üì± 844-225-88-73 / 844-106-88-12 &nbsp;|&nbsp;
      üì∑ @brothersfilmssaltillo
    </div>
  </div>

  <!-- MODAL: Link generado para compartir -->
  <div class="modal-overlay" id="link-modal">
    <div class="modal" style="max-width:500px">
      <div class="modal-icon">üîó</div>
      <h2>Link listo para compartir</h2>
      <p style="margin-bottom:14px">Copia este link y m√°ndalo al cliente por WhatsApp. Al abrirlo ver√° el contrato listo
        para firmar.</p>
      <div
        style="background:#f4f1eb;border:1.5px solid var(--border);border-radius:8px;padding:10px 14px;word-break:break-all;font-size:12px;color:var(--dark);text-align:left;margin-bottom:16px"
        id="link-display"></div>
      <div class="modal-actions">
        <button class="mbtn mbtn-green" onclick="copiarLink()">üìã Copiar Link</button>
        <button class="mbtn mbtn-dark"
          onclick="document.getElementById('link-modal').classList.remove('show')">Cerrar</button>
      </div>
      <div id="link-copy-status" style="font-size:12px;margin-top:10px;min-height:16px"></div>
    </div>
  </div>

  <!-- MODAL: Instrucciones para el cliente -->
  <div class="modal-overlay" id="client-modal">
    <div class="modal">
      <div class="modal-icon">üì±</div>
      <h2>Modo Cliente activado</h2>
      <p>El contrato ya est√° listo para que tu cliente lo <strong>lea y firme digitalmente</strong>.<br><br>
        üëâ P√≠dele que:<br>
        1. Lea los t√©rminos y condiciones<br>
        2. Dibuje su firma con el dedo o mouse<br>
        3. Haga clic en <strong>"‚úÖ Confirmar y Descargar"</strong></p>
      <div class="modal-actions">
        <button class="mbtn mbtn-green" onclick="closeModal()">Entendido, continuar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Email para env√≠o de confirmaci√≥n -->
  <div class="modal-overlay" id="email-modal">
    <div class="modal" style="max-width:460px">
      <div class="modal-icon">üìß</div>
      <h2>¬øD√≥nde enviamos tu copia?</h2>
      <p style="margin-bottom:16px">Ingresa tu correo electr√≥nico y te enviaremos autom√°ticamente un resumen de
        confirmaci√≥n del contrato.</p>
      <div style="text-align:left;margin-bottom:16px">
        <label
          style="font-size:11px;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px">Correo
          del cliente</label>
        <input type="email" id="email-input" placeholder="ejemplo@correo.com"
          style="width:100%;padding:10px 12px;border:1.5px solid var(--border);border-radius:7px;font-size:14px;font-family:'Inter',sans-serif;outline:none;transition:.2s"
          onfocus="this.style.borderColor='var(--gold)'" onblur="this.style.borderColor='var(--border)'" />
        <div id="email-status" style="font-size:12px;margin-top:8px;min-height:18px"></div>
      </div>
      <div class="modal-actions">
        <button class="mbtn mbtn-green" id="send-email-btn" onclick="sendEmailAndConfirm()">üì§ Enviar
          confirmaci√≥n</button>
        <button class="mbtn mbtn-dark" onclick="confirmSign(true)">Omitir y solo descargar PDF</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Confirmaci√≥n de firma -->
  <div class="modal-overlay" id="confirm-modal">
    <div class="modal">
      <div class="modal-icon">üéâ</div>
      <h2>¬°Contrato firmado!</h2>
      <p>Al confirmar, el contrato quedar√° registrado con tu firma digital. Se generar√° un PDF para guardar y compartir.
      </p>
      <div class="modal-actions">
        <button class="mbtn mbtn-green" onclick="showEmailModal()">üìß Enviar copia por correo</button>
        <button class="mbtn mbtn-dark" onclick="confirmSign(false)">Solo descargar PDF</button>
      </div>
    </div>
  </div>

  <!-- Librer√≠as para generaci√≥n de PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // ‚îÄ‚îÄ EMAILJS CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const EMAILJS_SERVICE_ID = 'service_6fgoowq';
    const EMAILJS_TEMPLATE_ID = 'template_n1q45jp';
    const EMAILJS_PUBLIC_KEY = 'ot0luAGVs3V2C_jxs';
    emailjs.init(EMAILJS_PUBLIC_KEY);
  </script>
  <script>
    // ‚îÄ‚îÄ ESTADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let currentMode = 'admin'; // 'admin' | 'client'
    let currentPlan = null;
    const canvases = {};
    const ctxs = {};
    let drawing = {};

    // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function val(id) {
      const el = document.getElementById(id);
      if (!el) return '';
      return (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') ? el.value.trim() : el.textContent.trim();
    }
    function setVal(id, text) {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.value = text;
      else el.textContent = text;
    }

    // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date();
      // YYYY-MM-DD para inputs tipo date
      const isoDate = today.toISOString().split('T')[0];

      setVal('contract-date', today.toLocaleDateString('es-MX', { day: '2-digit', month: 'long', year: 'numeric' }));
      setVal('f-fecha-firma', isoDate); // Ahora ser√° input de fecha

      const rnd = Math.floor(Math.random() * 900) + 100;
      setVal('contract-num', `BFS-${today.getFullYear()}-${rnd}`);

      initCanvas('client');
      initCanvas('brothers');
      initServices();
      cargarDesdeURL(); // Auto-carga datos desde URL si viene en modo cliente
    });

    // ‚îÄ‚îÄ PLAN SELECTOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const planData = {
      basico: {
        label: 'üì¶ Pack B√°sico ‚Äî $19,500 MXN', price: '$19,500',
        show: [], videoDur: '15-20 min'
      },
      estandar: {
        label: '‚≠ê Pack Est√°ndar ‚Äî $25,500 MXN', price: '$25,500',
        show: ['s-std', 's-makeup', 's-fl'], videoDur: '~40 min'
      },
      premium: {
        label: 'üíé Pack Premium ‚Äî $32,500 MXN', price: '$32,500',
        show: ['s-std', 's-vidsesion', 's-slide', 's-makeup', 's-fl', 's-familia',
          's-dron', 's-usb', 's-imp2024', 's-50fotos', 's-caja'], videoDur: '~60 min'
      }
    };
    const allOptional = ['s-std', 's-vidsesion', 's-slide', 's-makeup', 's-fl', 's-familia',
      's-dron', 's-usb', 's-imp2024', 's-50fotos', 's-caja'];

    function selectPlan(p, force = false) {
      if (currentMode === 'client' && !force) return; // bloqueado en modo cliente
      document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
      document.getElementById('plan-' + p).classList.add('selected');
      currentPlan = p;
      const d = planData[p];
      document.getElementById('plan-badge').textContent = d.label;
      document.getElementById('total-amt').textContent = d.price;
      document.getElementById('s-vidduration').textContent =
        `Video Full HD editado y musicalizado (${d.videoDur})`;
      // reset
      allOptional.forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none' });
      // show
      d.show.forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'flex' });
      // placeholders
      const hasPrevio = d.show.some(id => ['s-std', 's-vidsesion', 's-slide'].includes(id));
      document.getElementById('s-noprevio').style.display = hasPrevio ? 'none' : 'flex';
      const hasFisico = d.show.some(id => ['s-imp2024', 's-50fotos', 's-caja'].includes(id));
      document.getElementById('s-nofisico').style.display = hasFisico ? 'none' : 'flex';
    }

    function initServices() {
      allOptional.forEach(id => { const e = document.getElementById(id); if (e) e.style.display = 'none' });
      document.getElementById('s-noprevio').style.display = 'flex';
      document.getElementById('s-nofisico').style.display = 'flex';
    }

    // ‚îÄ‚îÄ MODOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchToClientMode() {
      currentMode = 'client';
      const banner = document.getElementById('mode-banner');
      banner.className = 'client';
      document.getElementById('mode-icon').textContent = 'üë§';
      document.getElementById('mode-text').textContent = 'MODO CLIENTE ‚Äî Lee el contrato y firma al final';

      // Cambiar acciones del banner
      banner.querySelector('.mode-actions').innerHTML = `
    <button class="mbtn mbtn-green" onclick="showConfirmModal()">‚úÖ Confirmar y Descargar PDF</button>
    <button class="mbtn mbtn-dark" onclick="window.print()">üñ®Ô∏è Imprimir</button>
  `;

      // Bloquear campos de datos (Tanto inputs como div contenteditable)
      document.querySelectorAll('.info-value, .pay-table td:not(:first-child), .sig-name').forEach(el => {
        if (el.tagName === 'INPUT') {
          el.readOnly = true;
          el.classList.add('disabled');
        } else {
          el.contentEditable = 'false';
        }
      });
      // Bloquear tarjetas de plan
      document.querySelectorAll('.plan-card').forEach(c => c.classList.add('locked'));

      // Mostrar firmas digitales
      document.getElementById('sig-digital').style.display = 'grid';
      document.getElementById('sig-static').style.display = 'none';

      // Actualizar fecha en sig
      const today = new Date().toLocaleDateString('es-MX', { day: '2-digit', month: 'long', year: 'numeric' });
      document.getElementById('sig-date-client').textContent = `Fecha: ${today}`;

      // Scroll al top y abrir modal
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById('client-modal').classList.add('show');
    }

    function switchToAdminMode() {
      location.reload();
    }

    function closeModal() {
      document.getElementById('client-modal').classList.remove('show');
      // Scroll a secci√≥n de firma
      setTimeout(() => {
        document.querySelector('.sig-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    }

    // ‚îÄ‚îÄ CANVAS DE FIRMA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function initCanvas(id) {
      const canvas = document.getElementById('canvas-' + id);
      const wrap = canvas.parentElement;
      canvas.width = wrap.offsetWidth || 380;
      ctxs[id] = canvas.getContext('2d');
      ctxs[id].strokeStyle = '#1a1a1a';
      ctxs[id].lineWidth = 2;
      ctxs[id].lineCap = 'round';
      ctxs[id].lineJoin = 'round';
      drawing[id] = false;
      canvases[id] = canvas;

      // Mouse
      canvas.addEventListener('mousedown', e => startDraw(id, e));
      canvas.addEventListener('mousemove', e => draw(id, e));
      canvas.addEventListener('mouseup', () => stopDraw(id));
      canvas.addEventListener('mouseleave', () => stopDraw(id));
      // Touch
      canvas.addEventListener('touchstart', e => { e.preventDefault(); startDraw(id, e.touches[0]) }, { passive: false });
      canvas.addEventListener('touchmove', e => { e.preventDefault(); draw(id, e.touches[0]) }, { passive: false });
      canvas.addEventListener('touchend', () => stopDraw(id));
    }

    function getPos(canvas, e) {
      const r = canvas.getBoundingClientRect();
      return {
        x: (e.clientX - r.left) * (canvas.width / r.width),
        y: (e.clientY - r.top) * (canvas.height / r.height)
      };
    }
    function startDraw(id, e) {
      drawing[id] = true;
      const pos = getPos(canvases[id], e);
      ctxs[id].beginPath();
      ctxs[id].moveTo(pos.x, pos.y);
      document.getElementById('ph-' + id).style.display = 'none';
      // Marcar como firmado en cuanto empiezan a dibujar
      document.getElementById('signed-badge-' + id).style.display = 'inline-flex';
    }
    function draw(id, e) {
      if (!drawing[id]) return;
      const pos = getPos(canvases[id], e);
      ctxs[id].lineTo(pos.x, pos.y);
      ctxs[id].stroke();
    }
    function stopDraw(id) {
      drawing[id] = false;
    }
    function clearCanvas(id) {
      ctxs[id].clearRect(0, 0, canvases[id].width, canvases[id].height);
      document.getElementById('ph-' + id).style.display = 'block';
      document.getElementById('signed-badge-' + id).style.display = 'none';
    }

    // ‚îÄ‚îÄ CONFIRMAR FIRMA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showConfirmModal() {
      // Verificar que hay firma del cliente (revisa canal alpha Y estado de dibujo)
      const canvas = canvases['client'];
      const ctx = ctxs['client'];
      let hasSignature = false;
      try {
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        // Revisar solo canal alpha (posiciones 3,7,11...) ‚Äî m√°s confiable
        for (let i = 3; i < data.length; i += 4) {
          if (data[i] > 10) { hasSignature = true; break; }
        }
      } catch (e) {
        // Si hay error de seguridad (file://) usar el badge como indicador
        hasSignature = document.getElementById('signed-badge-client')?.style.display !== 'none';
      }
      // Fallback: si el badge de "Firmado" est√° visible, hay firma
      const badge = document.getElementById('signed-badge-client');
      if (badge && badge.style.display !== 'none') hasSignature = true;

      if (!hasSignature) {
        alert('‚ö†Ô∏è Por favor firma el contrato antes de confirmar.');
        document.querySelector('.sig-section')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }
      document.getElementById('confirm-modal').classList.add('show');
    }

    function showEmailModal() {
      document.getElementById('confirm-modal').classList.remove('show');
      // Limpiar campo primero, luego pre-rellenar con email del cliente si existe
      const inputEl = document.getElementById('email-input');
      inputEl.value = '';
      const emailField = val('f-email');
      if (emailField) {
        inputEl.value = emailField;
      }
      // Seleccionar todo el texto para que el usuario pueda reemplazarlo f√°cilmente
      setTimeout(() => { inputEl.select(); inputEl.focus(); }, 100);
      document.getElementById('email-modal').classList.add('show');
    }

    // ‚îÄ‚îÄ GENERAR PDF LOCAL (alta calidad para descarga) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function generarPDFLocal() {
      const { jsPDF } = window.jspdf;
      const wrapper = document.getElementById('contract-wrapper') || document.body;
      const modales = document.querySelectorAll('.modal-overlay');
      const banner = document.getElementById('mode-banner');
      modales.forEach(m => m.style.display = 'none');
      if (banner) banner.style.display = 'none';

      const canvas = await html2canvas(wrapper, {
        scale: 2, useCORS: true, allowTaint: true,
        backgroundColor: '#f4f1eb', logging: false,
      });

      modales.forEach(m => m.style.display = '');
      if (banner) banner.style.display = '';

      const imgData = canvas.toDataURL('image/jpeg', 0.85);
      const pdfW = 210;
      const pdfH = (canvas.height * pdfW) / canvas.width;
      const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
      const pageH = pdf.internal.pageSize.getHeight();
      let posY = 0;
      while (posY < pdfH) {
        if (posY > 0) pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, -posY, pdfW, pdfH);
        posY += pageH;
      }
      return pdf.output('blob');
    }

    // ‚îÄ‚îÄ ENVIAR CORREO VIA EMAILJS (solo datos, sin PDF) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function sendEmailAndConfirm() {
      const email = document.getElementById('email-input').value.trim();
      const statusEl = document.getElementById('email-status');
      const btn = document.getElementById('send-email-btn');

      if (!email || !email.includes('@')) {
        statusEl.textContent = '‚ö†Ô∏è Por favor ingresa un correo v√°lido.';
        statusEl.style.color = 'var(--red)';
        return;
      }

      btn.textContent = '‚è≥ Enviando...';
      btn.disabled = true;
      statusEl.textContent = 'üìß Enviando correo de confirmaci√≥n...';
      statusEl.style.color = 'var(--gray)';

      try {
        // 1) Recopilar datos del contrato
        const contratante = val('f-contratante') || 'Cliente';
        const numContrato = val('contract-num') || 'BFS';
        const novios = val('f-novios') || '‚Äî';
        const evento = val('f-fecha-evento') || '‚Äî';
        const lugar = val('f-lugar') || '‚Äî';
        const tel = val('f-tel') || '‚Äî';
        const plan = val('plan-badge') || '‚Äî';
        const fechaFirma = new Date().toLocaleDateString('es-MX', { day: '2-digit', month: 'long', year: 'numeric' });

        // 2) Enviar v√≠a EmailJS
        const templateParams = {
          to_email: email,
          contratante: contratante,
          novios: novios,
          fecha_evento: evento,
          lugar: lugar,
          telefono: tel,
          plan: plan,
          num_contrato: numContrato,
          fecha_firma: fechaFirma
        };

        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);

        // 3) √âxito: mostrar confirmaci√≥n
        statusEl.innerHTML =
          '<b style="color:#1a7431">‚úÖ ¬°Correo enviado exitosamente!</b><br>' +
          '<span style="font-size:12px;color:#444;line-height:1.6">' +
          'Se envi√≥ la confirmaci√≥n del contrato a <b>' + email + '</b></span>';

        btn.textContent = '‚úÖ Correo enviado';
        btn.style.background = '#1a7431';
        btn.disabled = false;

        // 4) Descargar PDF localmente tambi√©n
        try {
          const fileName = `Contrato_BrothersFilms_${numContrato}.pdf`;
          const pdfBlob = await generarPDFLocal();
          const urlPDF = URL.createObjectURL(pdfBlob);
          const a = document.createElement('a');
          a.href = urlPDF; a.download = fileName;
          document.body.appendChild(a); a.click(); document.body.removeChild(a);
          setTimeout(() => URL.revokeObjectURL(urlPDF), 3000);
          statusEl.innerHTML +=
            '<br><span style="font-size:12px;color:#1a7431">üìÑ PDF descargado en tu carpeta de Descargas.</span>';
        } catch (pdfErr) {
          console.warn('PDF download fall√≥:', pdfErr);
        }

      } catch (err) {
        console.error('Error enviando correo:', err);
        statusEl.textContent = '‚ö†Ô∏è Error al enviar: ' + (err.text || err.message || 'intenta de nuevo');
        statusEl.style.color = 'var(--red)';
        btn.textContent = 'üì§ Reintentar';
        btn.disabled = false;
      }
    }

    function confirmSign(autoPrint = false) {
      const fecha = new Date().toLocaleDateString('es-MX', { day: '2-digit', month: 'long', year: 'numeric' });
      // Actualizar banner
      document.getElementById('mode-banner').innerHTML =
        `<div style="display:flex;align-items:center;gap:10px;width:100%;justify-content:center">
          <span style="font-size:18px">‚úÖ</span>
          <span>Contrato firmado digitalmente el ${fecha}</span>
          <button class="mbtn mbtn-gold" onclick="window.print()" style="margin-left:16px">üñ∏Ô∏è Descargar / Imprimir PDF</button>
        </div>`;
      if (autoPrint) setTimeout(() => window.print(), 800);
    }

    // ‚îÄ‚îÄ GENERAR LINK PARA CLIENTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function generarLinkCliente() {
      const contratante = val('f-contratante');
      const novios = val('f-novios');
      const fechaEvento = val('f-fecha-evento');
      const lugar = val('f-lugar');
      const tel = val('f-tel');
      const email = val('f-email');
      const fechaFirma = val('f-fecha-firma');
      const numContrato = val('contract-num');
      const plan = currentPlan || '';

      // VALIDACIONES
      if (!contratante) return alert('‚ö†Ô∏è El Nombre del Contratante es obligatorio.');
      if (!novios) return alert('‚ö†Ô∏è El Nombre de los Novios es obligatorio.');
      if (!fechaEvento) return alert('‚ö†Ô∏è La Fecha del Evento es obligatoria.');
      if (!email || !email.includes('@')) return alert('‚ö†Ô∏è Por favor ingresa un correo electr√≥nico v√°lido del cliente.');
      if (!plan) return alert('‚ö†Ô∏è Debes seleccionar un Plan antes de generar el link.');

      const params = new URLSearchParams({
        modo: 'cliente',
        contratante, novios, fechaEvento, lugar, tel, email, fechaFirma, numContrato, plan
      });

      const link = window.location.href.split('?')[0] + '?' + params.toString();
      document.getElementById('link-display').textContent = link;
      document.getElementById('link-copy-status').textContent = '';
      document.getElementById('link-modal').classList.add('show');
    }

    let _generatedLink = '';
    function copiarLink() {
      const link = document.getElementById('link-display').textContent;
      navigator.clipboard.writeText(link).then(() => {
        document.getElementById('link-copy-status').innerHTML = '<span style="color:#1a7431">‚úÖ Link copiado al portapapeles</span>';
      }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = link; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        document.getElementById('link-copy-status').innerHTML = '<span style="color:#1a7431">‚úÖ Link copiado</span>';
      });
    }

    // ‚îÄ‚îÄ CARGAR DESDE URL (modo cliente con datos) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function cargarDesdeURL() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('modo') !== 'cliente') return;

      // Rellenar campos
      setVal('f-contratante', params.get('contratante'));
      setVal('f-novios', params.get('novios'));
      setVal('f-fecha-evento', params.get('fechaEvento'));
      setVal('f-lugar', params.get('lugar'));
      setVal('f-tel', params.get('tel'));
      setVal('f-email', params.get('email'));
      setVal('f-fecha-firma', params.get('fechaFirma'));
      setVal('contract-num', params.get('numContrato'));

      // Seleccionar plan
      const plan = params.get('plan');
      if (plan && planData[plan]) selectPlan(plan, true); // force=true para pasar el guard

      // Cambiar autom√°ticamente a modo cliente
      switchToClientMode();
    }

    // ‚îÄ‚îÄ EJEMPLO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function fillSample() {
      setVal('f-contratante', 'Mar√≠a Gonz√°lez P√©rez');
      setVal('f-novios', 'Ana Gonz√°lez & Carlos Mart√≠nez');
      setVal('f-fecha-evento', '2026-08-15');
      setVal('f-lugar', 'Hacienda San Agust√≠n, Saltillo');
      setVal('f-tel', '8441234567');
      setVal('f-email', 'ana.carlos2026@gmail.com');
      selectPlan('estandar');
    }
  </script>
</body>

</html>